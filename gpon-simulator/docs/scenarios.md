# Документация сценариев атак

## Обзор

Система содержит 3 предустановленных сценария атак для демонстрации основных векторов компрометации GPON-инфраструктуры.

## Сценарий 1: DHCP Starvation and Spoofing

**ID**: `dhcp_starvation_001`

### Описание

Атака направлена на исчерпание пула DHCP-адресов путём массовой генерации DHCP discover-запросов, что приводит к отказу легитимным клиентам в получении IP-адресов. После исчерпания пула злоумышленник может подменить DHCP-ответы.

### Шаги выполнения

1. **Компрометация CPE устройств** (30 устройств)
   - Вектор: удалённая эксплуатация уязвимости RPM
   - Результат: устройства заражены и готовы выполнять команды

2. **DHCP Starvation** (60 секунд)
   - Каждое заражённое устройство отправляет 100 DHCP discover
   - Всего: 3000 запросов
   - Пул DHCP исчерпывается

3. **DHCP Spoofing**
   - Подмена DHCP-offer с фальшивым gateway
   - Подмена DNS-сервера
   - Вероятность успеха: 60%

### Ожидаемый результат

- Легитимные клиенты не получают IP-адреса
- Некоторые клиенты получают поддельный DNS

### Наблюдаемость

**Логи**:
- DHCP: массовые discover от множества MAC-адресов
- Подозрительные offer с нестандартными параметрами

**Метрики**:
- DHCP пул: 0 доступных адресов
- Uplink-нагрузка: >80%

**Детектирование**:
- Мониторинг скорости DHCP-запросов
- Анализ аномалий в DHCP-offer
- Alert при 100% использовании пула

---

## Сценарий 2: OMCI Unauthorized Modification

**ID**: `omci_unauth_001`

### Описание

Злоумышленник получает несанкционированный доступ к OLT и выполняет OMCI-команды для изменения конфигурации ONT. Это может привести к потере связи или перенаправлению трафика в несанкционированную VLAN.

### Шаги выполнения

1. **OMCI set VLAN**
   - Целевой ONT: первый онлайн
   - Команда: изменение VLAN на 999
   - Вероятность успеха: 80%

2. **Reboot ONT**
   - Ожидание: 3 секунды
   - Применение изменений
   - Вероятность успеха: 95%

### Ожидаемый результат

- ONT теряет коннективность
- Трафик перенаправляется в VLAN 999

### Наблюдаемость

**Логи**:
- OMCI: несанкционированные команды от администратора
- SSH: вход в OLT
- Конфигурация ONT: изменения VLAN

**Метрики**:
- Статус ONT: offline
- Изменения VLAN: счетчик увеличивается

**Детектирование**:
- Мониторинг OMCI-команд
- Alert при изменении конфигурации без предварительного запроса
- Анализ SSH-логов на предмет взлома

---

## Сценарий 3: ARP Spoofing and MITM

**ID**: `arp_mitm_001`

### Описание

Атака ARP poisoning для установки Man-in-the-Middle позиции. Злоумышленник подменяет ARP-таблицы, чтобы перехватывать трафик между жертвой и шлюзом.

### Шаги выполнения

1. **Компрометация CPE** (1 устройство)
   - Вектор: локальный доступ
   - Результат: устройство под контролем атакующего

2. **ARP Spoofing**
   - Целевой IP: 192.168.1.1 (gateway)
   - Подмена MAC: aa:bb:cc:dd:ee:ff
   - Результат: ARP-таблица заражена

### Ожидаемый результат

- Трафик перехватывается
- MITM успешно установлен

### Наблюдаемость

**Логи**:
- ARP: массивные ARP-ответы от подозрительного MAC
- ARP-таблица: неконсистентные записи

**Метрики**:
- Изменения ARP-таблицы: скачок

**Детектирование**:
- Мониторинг ARP-ответов на предмет подозрительных MAC
- Детекция аномалий в ARP-трафике
- Alert при множественных ARP-ответах от одного источника

---

## Создание собственного сценария

### Формат JSON

```json
{
  "id": "custom_scenario_001",
  "name": "Custom Attack",
  "description": "Описание атаки",
  "category": "attack_category",
  "steps": [
    {
      "step_number": 1,
      "action": "custom_action",
      "parameters": {"param1": "value1"},
      "delay_seconds": 5
    }
  ],
  "expected_outcome": ["outcome1", "outcome2"],
  "observability": {
    "logs": ["log_type1", "log_type2"],
    "metrics": ["metric1", "metric2"]
  }
}
```

### Доступные действия

- `compromise_cpe`: Заражение CPE устройств
- `dhcp_starvation`: DHCP starvation атака
- `dhcp_spoof`: DHCP spoofing
- `omci_modify`: OMCI модификация
- `arp_spoof`: ARP spoofing
- `igmp_flood`: IGMP flood
- `ddos_uplink`: DDoS на uplink
- `infect_botnet`: Заражение ботнетом

### Параметры действий

**compromise_cpe**:
```json
{
  "count": 30,
  "infect_method": "rpm_exploit"
}
```

**dhcp_starvation**:
```json
{
  "duration_s": 60,
  "requests_per_device": 100
}
```

**omci_modify**:
```json
{
  "ont_id": "auto",
  "command": "set_vlan",
  "vlan": 999
}
```

## Тестирование сценариев

### Ручной запуск

```bash
# API запрос
curl -X POST http://localhost:8000/api/scenarios/dhcp_starvation_001/run

# Проверка статуса
curl http://localhost:8000/api/scenarios/dhcp_starvation_001/status
```

### Автоматическое тестирование

```python
import requests

BASE_URL = "http://localhost:8000"

# Запустить сценарий
response = requests.post(f"{BASE_URL}/api/scenarios/dhcp_starvation_001/run")
print(response.json())

# Дождаться завершения
import time
time.sleep(5)

# Проверить метрики
metrics = requests.get(f"{BASE_URL}/api/metrics")
print(metrics.json())
```

## Следующие шаги

1. Запустите каждый сценарий индивидуально
2. Наблюдайте за логами и метриками
3. Попробуйте создать свой сценарий
4. Документируйте результаты для ВКР

