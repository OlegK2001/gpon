# Инструкции по развертыванию GPON Simulator

## Docker развертывание

### Сборка и запуск

```bash
# Сборка и запуск контейнера
docker compose up -d --build

# Просмотр логов
docker compose logs -f

# Остановка
docker compose down

# Перезапуск сервиса
docker compose restart
```

### Переменные окружения

Переменные окружения можно настроить в `docker-compose.yml` в секции `environment`:

```yaml
environment:
  - NODE_ENV=production
  - PORT=3000
  - HOSTNAME=0.0.0.0
```

### Healthcheck

Контейнер автоматически проверяет здоровье приложения каждые 30 секунд. Если проверка не проходит 3 раза подряд, Docker перезапустит контейнер.

### Автоперезапуск

Контейнер настроен с политикой `restart: unless-stopped`, что означает:
- Автоматический перезапуск при сбоях
- Автоматический перезапуск при перезагрузке системы
- Остановка только при явной команде `docker compose stop`

## Сборка в .exe файл

### Требования

- Node.js 18+
- npm или yarn
- Windows (для сборки Windows .exe)

### Шаги сборки

1. Установите зависимости:
```bash
npm install
```

2. Соберите production build:
```bash
npm run build
```

3. Соберите .exe файл:
```bash
npm run build:exe
```

4. Результат будет в папке `dist/`:
   - `gpon-simulator.exe` - исполняемый файл
   - `.next/` - папка с ресурсами приложения

### Запуск .exe

**Важно**: `.exe` файл должен находиться в той же директории, что и папка `.next/` с ресурсами.

Структура должна быть такой:
```
dist/
  ├── gpon-simulator.exe
  └── .next/
      ├── standalone/
      └── static/
```

Запустите `gpon-simulator.exe` двойным кликом или из командной строки.

### Ограничения

Из-за особенностей Next.js и динамических импортов, полная упаковка в один файл невозможна. Приложение требует:
- `.exe` файл
- Папку `.next/` с ресурсами рядом с .exe

Это стандартное ограничение для Next.js приложений при использовании `pkg` или `nexe`.

### Альтернативные варианты

Если требуется полностью автономный .exe:
1. Использовать Electron для создания desktop приложения
2. Использовать установщик (NSIS, Inno Setup) для создания установочного пакета
3. Использовать portable версию с распаковкой в temp директорию

## Разработка

### Локальный запуск

```bash
npm run dev
```

Приложение будет доступно на `http://localhost:3000`

### Production сборка

```bash
npm run build
npm start
```

## Устранение неполадок

### Docker

- **Контейнер не запускается**: Проверьте логи `docker compose logs`
- **Порт занят**: Измените порт в `docker-compose.yml` (например, `3001:3000`)
- **Ошибки сборки**: Убедитесь, что Dockerfile корректно настроен

### .exe сборка

- **Ошибка "Cannot find server.js"**: Убедитесь, что папка `.next/` находится рядом с .exe
- **Большой размер .exe**: Это нормально, так как включает Node.js runtime
- **Антивирус блокирует**: Добавьте исключение для папки `dist/`

